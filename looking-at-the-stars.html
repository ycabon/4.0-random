<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Looking at the stars</title>
  <link rel="stylesheet" href="//jsdev.arcgis.com/4.0beta2/esri/css/esri.css">
  <script src="//jsdev.arcgis.com/4.0beta2/"></script>
  <style>
    html, body, #mapDiv {
      padding: 0;
      margin: 0;
    }
  </style>
  <script>
    var map;

    require([
      "esri/core/Scheduler",

      "esri/Map",
      "esri/views/SceneView",
      "esri/layers/SceneLayer",

      "dojo/domReady!"
    ],
    function(
      Scheduler,
      Map, SceneView,
      SceneLayer
    ) {

      view = new SceneView({

        // position in Brest, France
        camera: {
          position: {
            x: -500180.36326436285,
            y: 6170505.2115241615,
            z: 27.623250141739845,
            spatialReference: {
              wkid: 102100
            }
          },
          heading: 204.85093814976383,
          tilt: 104.94117423132887,
          fov: 80
        },

        container: "mapDiv",

        environment: {
          lighting: {
            directShadows: true,
            ambientOcclusion: true,
            date: new Date("Jan 1 2015 12:00:00 GMT+0200") // midnight in Brest
          }
        },

        map: new Map({
          basemap: "satellite",
          layers: [
            new SceneLayer({
              url: "//scene.arcgis.com/arcgis/rest/services/Hosted/Buildings_Brest/SceneServer/layers/0"
            })
          ]
        }),

        ui: {
          components: ["logo"]
        }
      });

      var dateDiv = document.getElementById("dateDiv");
      var minute = 60 * 1000;
      function updateDatefield() {
        var date = new Date();
        date.setTime(view.environment.lighting.date.getTime() + 2 * minute);
        view.environment.lighting.date = date;
        dateDiv.innerHTML = date.toLocaleString("fr-FR", {
          timeZone: "Europe/Paris"
        });
      };
      updateDatefield();

      view.then(function() {
        // TODO: update when available as a env prop
        view.environmentManager.realisticAtmosphere = true;

        // every frame
        handle = Scheduler.addFrameTask({
          update: function() {
            if (view.updating) {
              return;
            }
            // increment time
            updateDatefield();
          }
        })
      });

      
    });
  </script>
</head>
<body>
  <div id="mapDiv" style="pointer-events: none; width: 100%; height: 100%; "></div>
  <div id="dateDiv" style="position: absolute; left: 20px; top: 20px; font-size: 40px; color: white; font-family: Lucida Grande, Helvetica, sans-serif;"></div>
</body>
</html>
